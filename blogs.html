<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="css/style.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/constants.js"></script>
    <script src="js/datetime.js"></script>
    <script src="js/blog.js"></script>
    <script src="js/backtotop.js"></script>
    <title>Scale Up | Blog</title>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico" />
  </head>

  <body>
    <header>
      <nav>
        <a href="index.html">
          <img src="images/logo.png" id="logo" alt="Logo" id="logo" />
        </a>
        <a href="index.html"
          ><h1 id="company-name"><em>scale up</em></h1></a
        >
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="jobs.html">Jobs</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="login.html">Login</a></li>
        </ul>
      </nav>
    </header>
    <br />
    <h2 id="job-heading">Welcome To Our Blog Posts...</h2>
    <input type="text" id="searchInput" placeholder="Search Blogs" />
    <div id="blog-listings">
      <div class="blog-listing"></div>
    </div>
    <br />
    <div id="back-to-top" class="hidden">
      <a href="#" id="scroll-to-top-button">Back to Top</a>
    </div>
    <footer>
      <div id="footer-links">
        <a href="index.html ">Home</a>
        <a href="jobs.html">Jobs</a>
        <a href="#">Blogs</a>
        <a href="contact.html">Contact</a>
        <a href="login.html">Login</a>
      </div>
      <div id="copyright">Copyright Â© 2023 SCALE UP</div>
    </footer>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("searchInput");
        const resultsContainer = document.getElementById("blog-listings");

        let latestData = []; // Variable to store the latest data
        let searchTimeout; // Variable to store the search timeout

        function fetchData(apiUrl) {
          return fetch(apiUrl).then((response) => response.json());
        }

        function search() {
          // Clear the previous search timeout
          clearTimeout(searchTimeout);

          const searchTerm = searchInput.value.toLowerCase();
          const apiUrl = BLOG_LIST_PATH; // Replace with your API endpoint

          // Delay the search by 1 second after the user stops typing
          searchTimeout = setTimeout(() => {
            // Clear previous results
            resultsContainer.innerHTML = "";

            // Fetch data from the API
            fetchData(apiUrl)
              .then((data) => {
                latestData = data; // Store the latest data

                const uniqueData = [];
                const titleSet = new Set();

                // Filter and store unique items in uniqueData array
                data.forEach((item) => {
                  if (
                    item.title.toLowerCase().includes(searchTerm) &&
                    !titleSet.has(item.title)
                  ) {
                    titleSet.add(item.title);
                    uniqueData.push(item);
                  }
                });
                uniqueData.sort(function (a, b) {
                  var c = new Date(a.date).getTime();
                  var d = new Date(b.date).getTime();
                  return c < d ? 1 : -1;
                });
                // Display unique results
                if (uniqueData.length > 0) {
                  uniqueData.forEach((item) => {
                    const resultItem = document.createElement("div");
                    var image = item.tag
                      ? '<img src="' +
                        "images/" +
                        item.tag +
                        ".png" +
                        '"' +
                        ' class="blog-image" loading="lazy" alt="' +
                        item.tag +
                        '"></img>'
                      : '<img src="' +
                        "images/white_paper.png" +
                        '"' +
                        ' class="blog-image" loading="lazy" alt="' +
                        "white_paper" +
                        '"></img>';
                    resultItem.innerHTML =
                      '<div class="job-listing">' +
                      "<h3>" +
                      item.title +
                      "</h3>" +
                      image +
                      "<p>Author: " +
                      item.author +
                      "</p>" +
                      "<p>Date: " +
                      globalDate(item.date) +
                      "</p>" +
                      '<p class="blog-desc">Description: ' +
                      descriptionVal(item.description, 50) +
                      "</p>" +
                      "<p>Source: " +
                      item.source +
                      "</p>" +
                      '<a href="' +
                      item.more +
                      '"' +
                      ' target="_blank" class="apply-button">See More</a>';
                    resultsContainer.appendChild(resultItem);
                  });
                } else {
                  resultsContainer.innerHTML =
                    "<p id='job-heading'>No results found.</p>";
                }
              })
              .catch((error) => {
                console.error("Error fetching data: ", error);
              });
          }, 500); // Adjust the delay to your preference (1 second = 1000 milliseconds)
        }

        // Event listener for input field
        searchInput.addEventListener("input", search);

        function checkJobExpired(listing) {
          var d1 = new Date().getDate();
          var d2 = new Date(listing.lastdate).getDate();
          return d1 <= d2;
        }
      });
    </script>
  </body>
</html>
